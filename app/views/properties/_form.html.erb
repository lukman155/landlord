<h1>New Property</h1>

<%= form_with(model: property) do |form| %>
  <% if property.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(property.errors.count, "error") %> prohibited this property from being saved:</h2>

      <ul>
        <% property.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form.hidden_field :landlord_id, value: current_user.id %>

  <div>
    <%= form.label :property_name, style: "display: block" %>
    <%= form.text_field :property_name %>
  </div>

  <div>
    <%= form.label :address, style: "display: block" %>
    <%= form.text_field :address %>
  </div>

  <div>
    <%= form.label :rent_amount, style: "display: block" %>
    <%= form.text_field :rent_amount %>
  </div>

  <div>
    <%= form.label :property_type, style: "display: block" %>
    <%= form.text_field :property_type %>
  </div>

  <div>
    <%= form.label :description, style: "display: block" %>
    <%= form.text_area :description %>
  </div>

  <div>
    <%= form.label :images, 'Images (multiple)' %>
    <%= form.file_field :images, multiple: true %>
  </div>

  <div class="field">
    <%= form.label :number_of_rooms %>
    <%= form.number_field :number_of_rooms %>
  </div>

  <%= form.fields_for :rooms do |room_form| %>
    <fieldset>
      <legend>Rooms</legend>

      <% property.number_of_rooms.to_i.times do |i| %>
        <div class="room-fields">
          <%= room_form.hidden_field :room_number, value: i + 1 %>
          
          <div class="field">
            <%= room_form.label :rent_amount, "Room #{i + 1} Rent Amount" %>
            <%= room_form.text_field :rent_amount %>
          </div>

          <div class="field">
            <%= room_form.label :room_type, "Room #{i + 1} Type" %>
            <%= room_form.text_field :room_type %>
          </div>
        </div>
      <% end %>
    </fieldset>
  <% end %>

  <div>
    <%= form.submit %>
  </div>
<% end %>

<br>

<div>
  <%= link_to "Back to properties", properties_path %>
</div>
